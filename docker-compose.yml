version: "3.9"
services:
  redis:
    image: redis:7-alpine
    restart: unless-stopped
    ports: ["6379:6379"]
  app:
    build: .
    environment:
      - PORT=8080
      - GOOGLE_MAPS_JS_KEY=${GOOGLE_MAPS_JS_KEY}
      - GOOGLE_MAPS_WEB_KEY=${GOOGLE_MAPS_WEB_KEY}
      - OPENWEATHER_API_KEY=${OPENWEATHER_API_KEY}
      - ACCUWEATHER_API_KEY=${ACCUWEATHER_API_KEY}
      - GOOGLE_APPLICATION_CREDENTIALS=/app/service-account.json
      - GOOGLE_DRIVE_FOLDER_ID=${GOOGLE_DRIVE_FOLDER_ID}
      - REDIS_URL=redis://redis:6379
      - CACHE_TTL_SECONDS=120
      - EMI_HALFLIFE_DAYS=3
    volumes:
      - ./service-account.json:/app/service-account.json:ro
      - ./data:/app/data
    ports:
      - "8080:8080"
    depends_on: [redis]